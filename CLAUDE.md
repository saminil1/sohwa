# 소화(sohwa.org) 시스템 코드베이스 분석 보고서

## 1. 서버 환경 정보

### 하드웨어 및 호스팅
- **서버**: uwa64-044.cafe24.com (Cafe24 공유 호스팅)
- **IP 주소**: 222.122.86.197
- **운영체제**: CentOS Linux 7 (Core)
- **커널**: Linux 3.10.0-1160.119.1.el7.x86_64

### 디스크 사용량 (2025-08-02 정리 후)
- **총 할당량**: 7,000,000 블록 (약 6.7GB)
- **현재 사용**: 1,171MB (17% 사용) - 이전: 6,292MB (92%)
- **남은 공간**: 약 5,665MB (5.5GB)
- **파일 수**: 13,631개 (이전: 29,090개)

### 주요 디렉토리 크기 (2025-08-02 정리 후)
- **/www/sohwa**: 메인 웹사이트
- **/www/sohwa/data**: 327MB (이전: 5.4GB)
- **/www/sohwa/data/file**: 325MB (이전: 4.4GB)
- **/www/sohwa/data/cheditor4**: 176KB (이전: 441MB)
- **/www/sohwa/data/geditor**: 244KB (이전: 508MB)
- **/www/sohwa/data/session**: 1.8MB

## 2. 웹 애플리케이션 구조

### CMS 정보
- **플랫폼**: 그누보드4 (GNUBOARD 4)
- **PHP 버전**: 5.2.17p1
- **문자셋**: UTF-8
- **설치일**: 2010년 5월 (추정)
- **마지막 주요 업데이트**: 2017년 4월

### 디렉토리 구조
```
/home/hosting_users/jesusmark2/
├── www/
│   ├── sohwa/                    # 메인 사이트 (그누보드4)
│   │   ├── adm/                  # 관리자 페이지
│   │   ├── bbs/                  # 게시판 시스템
│   │   ├── cheditor4/            # CHEditor 4 (WYSIWYG 에디터)
│   │   ├── skin/                 # 스킨 디렉토리
│   │   │   ├── board/            # 게시판 스킨 (20종)
│   │   │   ├── latest/           # 최신글 스킨
│   │   │   ├── member/           # 회원 관련 스킨
│   │   │   └── outlogin/         # 로그인 스킨
│   │   ├── data/                 # 데이터 디렉토리 (권한: 777)
│   │   │   ├── session/          # 세션 파일 (1.7GB)
│   │   │   ├── file/             # 업로드 파일
│   │   │   └── cheditor4/        # 에디터 업로드
│   │   ├── lib/                  # 라이브러리
│   │   ├── include/              # 공통 포함 파일
│   │   └── extend/               # 확장 기능 (비어있음)
│   └── 기타 디렉토리들
└── DataBackup/                   # 백업 디렉토리
```

## 3. 데이터베이스 구조

### 연결 정보
- **호스트**: localhost
- **데이터베이스명**: jesusmark2
- **사용자**: jesusmark2
- **비밀번호**: wotjddl2
- **테이블 접두사**: g4_

### 주요 테이블 구조
1. **기본 그누보드 테이블** (g4_ 접두사)
   - g4_member: 회원 정보 (총 3,689명)
   - g4_board: 게시판 설정
   - g4_board_file: 첨부파일
   - g4_group: 게시판 그룹
   - g4_point: 포인트 관리
   - g4_visit: 방문자 통계

2. **MW Basic 확장 테이블**
   - g4_mw_basic_config: MW Basic 설정
   - g4_mw_board_member: 게시판별 회원 권한
   - g4_mw_comment_file: 댓글 첨부파일
   - g4_mw_vote: 투표 기능
   - g4_mw_reward: 리워드 기능

3. **게시판 테이블** (g4_write_ 접두사)
   - 약 30개 이상의 게시판 운영
   - 주요 게시판: 본당소개, 사목협의회, 예비자입교 등

4. **기타 테이블**
   - Factory_Master, Factory_Output: 유니폼 생산 관련

## 4. 코드베이스 분석

### 핵심 파일
1. **설정 파일**
   - `config.php`: 그누보드 기본 설정
   - `dbconfig.php`: 데이터베이스 연결 정보
   - `common.php`: 공통 함수 및 초기화

2. **레이아웃 파일**
   - `head.php`, `head.sub.php`: 헤더
   - `tail.php`, `tail.sub.php`: 푸터
   - `mainhead.php`, `maintail.php`: 메인페이지 전용

3. **주요 기능 파일**
   - `index.php`: 메인 페이지
   - `/bbs/`: 게시판 관련 기능
   - `/adm/`: 관리자 기능

### 사용 플러그인/모듈
1. **에디터**: CHEditor 4
2. **게시판 확장**: MW Basic (가장 많이 사용)
3. **파일 업로드**: GUploader
4. **갤러리**: DangsGallery

### 스킨 현황
- **게시판 스킨**: 20종
  - basic, basic_01, basic-cate5
  - mw.basic (메인 스킨)
  - CCMCALL, gallery, calendar
  - schedule 관련 스킨

## 5. 메뉴 구조

### 그룹별 메뉴
1. **본당안내** (m1)
   - 사목지침, 본당연혁, 성직/수도직
   - 미사안내, 본당주보, 오시는길

2. **단체&복지시설** (m3)
   - 사목협의회, 단체소개
   - 청년단체, 청소년단체
   - 근화유치원, 소화묘원

3. **자료실** (m4)
4. **본당게시판** (m5)
5. **가톨릭마당** (m6)

## 6. 유니폼 관련 정보

### 분석 결과
- **웹사이트에 유니폼 관련 메뉴나 콘텐츠가 명시적으로 표시되지 않음**
- Factory_Master, Factory_Output 테이블은 백엔드 생산 관리용으로 추정
- 유니폼 제작/주문은 오프라인 또는 별도 경로로 처리하는 것으로 보임
- 신당동성당의 일반적인 성당 홈페이지로 운영 중

## 7. 보안 및 성능 이슈

### 보안 문제
1. **PHP 버전**: 5.2.17 (2011년 이후 지원 종료, 심각한 보안 취약점)
2. **권한 설정**: data 디렉토리 777 권한 (보안 위험)
3. **그누보드4**: 지원 종료된 버전
4. **.htaccess**: 없음 (보안 설정 미흡)

### 성능 문제
1. **디스크 공간**: 92% 사용 (공간 부족)
2. **세션 파일**: 1.7GB 누적 (정리 필요)
3. **백업 파일**: 홈 디렉토리에 121MB 덤프 파일

## 8. 권장사항

### 즉시 조치 필요
1. **세션 파일 정리**: `/data/session/` 디렉토리 정리
2. **백업 파일 이동**: 불필요한 백업 파일 삭제 또는 외부 저장
3. **권한 설정**: data 디렉토리 권한 조정 (755 권장)

### 중장기 개선사항
1. **그누보드5 마이그레이션**: 보안 및 기능 개선
2. **PHP 업그레이드**: 최소 PHP 7.4 이상
3. **백업 시스템**: 자동화된 백업 및 외부 저장소 활용
4. **보안 강화**: 
   - .htaccess 설정
   - SQL Injection 방지
   - XSS 방지 코드 추가

### 데이터 관리
1. **회원 정보**: 3,689명 (활성/비활성 분류 필요)
2. **게시판 정리**: 사용하지 않는 게시판 정리
3. **첨부파일**: 오래된 파일 아카이빙

## 9. 결론

소화 웹사이트는 2010년부터 운영된 그누보드4 기반 시스템으로, 
안정적으로 운영되고 있으나 보안 및 성능 개선이 시급합니다. 
특히 PHP 버전 업그레이드와 그누보드5로의 마이그레이션이 필요하며, 
당장은 디스크 공간 확보를 위한 세션 파일 정리가 필요합니다.

## 10. 접속 정보 요약

### SSH/FTP 접속
- **호스트**: sohwa.org
- **사용자**: jesusmark2
- **비밀번호**: wotjddl2
- **포트**: SSH(22), FTP(21)

### 데이터베이스 접속
- **호스트**: localhost
- **DB명**: jesusmark2
- **사용자**: jesusmark2
- **비밀번호**: wotjddl2

### 관리자 페이지 접속
- **URL**: http://sohwa.org/sohwa/adm/
- **아이디**: admin
- **비밀번호**: ikongboo26341@ (2025-08-01 재설정)

### 주요 경로
- **홈 디렉토리**: /home/hosting_users/jesusmark2
- **웹 루트**: /home/hosting_users/jesusmark2/www
- **그누보드**: /home/hosting_users/jesusmark2/www/sohwa

## 11. 디스크 공간 정리 기록 (2025-08-02)

### 정리 작업 내용
1. **file 디렉토리**: 3년 이상 된 파일 13,611개 삭제 (1.3GB)
2. **cheditor4 디렉토리**: 3년 이상 된 파일 1,346개 삭제 (441MB)
3. **geditor 디렉토리**: 3년 이상 된 파일 611개 삭제 (508MB)

### 백업 파일 위치
- `/home/hosting_users/jesusmark2/old_files_list_20250801.txt`
- `/home/hosting_users/jesusmark2/old_cheditor_files_20250801.txt`
- `/home/hosting_users/jesusmark2/old_geditor_files_20250801.txt`

### 정리 결과
- **확보된 공간**: 약 5.1GB
- **디스크 사용률**: 92% → 17%로 감소
- **삭제된 총 파일 수**: 15,568개